syntax = "proto3";

package elixir_cqrs;

import "common.proto";

// カテゴリサービスの定義

// カテゴリモデル
message Category {
  string id = 1;
  string name = 2;
  int32 product_count = 3;
  Timestamp created_at = 4;
  Timestamp updated_at = 5;
}

// コマンド側のサービス定義
service CategoryCommandService {
  rpc CreateCategory(CreateCategoryRequest) returns (CreateCategoryResponse);
  rpc UpdateCategory(UpdateCategoryRequest) returns (UpdateCategoryResponse);
  rpc DeleteCategory(DeleteCategoryRequest) returns (DeleteCategoryResponse);
}

// コマンド側のメッセージ定義
message CreateCategoryRequest {
  string name = 1;
  map<string, string> metadata = 2;
}

message CreateCategoryResponse {
  Result result = 1;
  string id = 2;
}

message UpdateCategoryRequest {
  string id = 1;
  string name = 2;
  map<string, string> metadata = 3;
}

message UpdateCategoryResponse {
  Result result = 1;
}

message DeleteCategoryRequest {
  string id = 1;
  map<string, string> metadata = 2;
}

message DeleteCategoryResponse {
  Result result = 1;
}

// クエリ側のサービス定義
service CategoryQueryService {
  rpc GetCategory(GetCategoryRequest) returns (GetCategoryResponse);
  rpc ListCategories(ListCategoriesRequest) returns (ListCategoriesResponse);
  rpc SearchCategories(SearchCategoriesRequest) returns (SearchCategoriesResponse);
}

// クエリ側のメッセージ定義
message GetCategoryRequest {
  string id = 1;
}

message GetCategoryResponse {
  Category category = 1;
  Error error = 2;
}

message ListCategoriesRequest {
  Pagination pagination = 1;
  Sort sort = 2;
}

message ListCategoriesResponse {
  repeated Category categories = 1;
  int32 total_count = 2;
  Error error = 3;
}

message SearchCategoriesRequest {
  string search_term = 1;
  Pagination pagination = 2;
}

message SearchCategoriesResponse {
  repeated Category categories = 1;
  int32 total_count = 2;
  Error error = 3;
}