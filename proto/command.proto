syntax = "proto3";

package proto;

option go_package = "/pb";

import "models.proto";
import "error.proto";
import "google/protobuf/timestamp.proto";

enum CRUD {
  UNKNOWN = 0; // 不明
  INSERT = 1; // 追加
  UPDATE = 2; // 変更
  DELETE = 3; // 削除
}

// 商品カテゴリ更新 Param 型
message CategoryUpParam {
  CRUD crud = 1; // CRUD 操作
  string id = 2; // 商品カテゴリ番号
  string name = 3; // 商品カテゴリ名
}

// 商品更新 Param 型
message ProductUpParam {
  CRUD crud = 1; // CRUD 操作
  string id = 2; // 商品番号
  string name = 3; // 商品名
  double price = 4; // 商品価格
  string categoryId = 5; // 商品カテゴリ番号
}

// 商品カテゴリ更新 Result 型
message CategoryUpResult {
  Category category = 1; // 更新結果
  Error error = 2; // エラー情報
  google.protobuf.Timestamp timestamp = 3; // 更新日時
}

// 商品更新 Result 型
message ProductUpResult {
  Product product = 1; // 更新結果
  Error error = 2; // エラー情報
  google.protobuf.Timestamp timestamp = 3; // 更新日時
}

// 商品カテゴリ更新サービス型
service CategoryCommand {
  // 商品カテゴリを追加した結果を返す
  rpc Create(CategoryUpParam) returns (CategoryUpResult);
  // 商品カテゴリを更新した結果を返す
  rpc Update(CategoryUpParam) returns (CategoryUpResult);
  // 商品カテゴリを削除した結果を返す
  rpc Delete(CategoryUpParam) returns (CategoryUpResult);
}

// 商品更新サービス型
service ProductCommand {
  // 商品を追加した結果を返す
  rpc Create(ProductUpParam) returns (ProductUpResult);
  // 商品を更新した結果を返す
  rpc Update(ProductUpParam) returns (ProductUpResult);
  // 商品を削除した結果を返す
  rpc Delete(ProductUpParam) returns (ProductUpResult);
}

// Saga関連の型定義
message OrderItem {
  string productId = 1;
  string productName = 2;
  int32 quantity = 3;
  double unitPrice = 4;
  double subtotal = 5;
}

message ShippingAddress {
  string street = 1;
  string city = 2;
  string postalCode = 3;
}

// Order Saga開始パラメータ
message StartOrderSagaParam {
  string orderId = 1;
  string customerId = 2;
  repeated OrderItem items = 3;
  double totalAmount = 4;
  ShippingAddress shippingAddress = 5;
}

// Saga開始結果
message StartSagaResult {
  string sagaId = 1;
  string status = 2;
  google.protobuf.Timestamp startedAt = 3;
  Error error = 4;
}

// Sagaコマンドサービス
service SagaCommand {
  // Order Sagaを開始
  rpc StartOrderSaga(StartOrderSagaParam) returns (StartSagaResult);
}